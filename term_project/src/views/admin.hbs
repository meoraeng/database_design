<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-3 col-lg-2 d-md-block bg-dark sidebar shadow-sm">
      <div class="position-sticky">
        <h4 class="py-3 text-center text-white border-bottom">관리자 탭</h4>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link py-3 fw-bold {{#if isBooks}}active{{/if}}" href="/admin?type=books">
              Books 관리
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link py-3 fw-bold {{#if isAuthors}}active{{/if}}" href="/admin?type=authors">
              Authors 관리
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link py-3 fw-bold {{#if isAwards}}active{{/if}}" href="/admin?type=awards">
              Awards 관리
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link py-3 fw-bold {{#if isWarehouses}}active{{/if}}" href="/admin?type=warehouses">
              Warehouses 관리
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link py-3 fw-bold {{#if isInventory}}active{{/if}}" href="/admin?type=inventory">
              Inventory 관리
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link py-3 fw-bold {{#if isContains}}active{{/if}}" href="/admin?type=contains">
              Contains 관리
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 bg-light content-area shadow-sm">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h2>Admin Dashboard</h2>
      </div>

      <!-- 성공 메시지 표시 -->
      {{#if successMessage}}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          {{successMessage}}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="닫기"></button>
        </div>
      {{/if}}

      <!-- 오류 메시지 표시 -->
      {{#if errorMessage}}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          {{errorMessage}}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="닫기"></button>
        </div>
      {{/if}}

      <!-- 쿼리 타입에 따라 동적으로 렌더링 되는 페이지들-->
      {{#if isBooks}}
        <section id="books-management">
          <h3>책 데이터 관리</h3>
          <div class="container mt-4">
            <!-- 입력 폼 -->
            <form id="bookForm" action="/admin/books/add" method="POST" class="mb-5">
              <input type="hidden" id="formMode" name="mode" value="add"> <!-- 디폴트는 데이터 추가 -->

              <!-- 시각적 표시 -->
              <div id="formModeIndicator" class="alert alert-primary text-center mb-3">
                현재 모드: <strong>새로운 데이터 추가</strong>
              </div>

              <div class="row g-3">
                <div class="col-md-6">
                  <label for="bookTitle" class="form-label">제목</label>
                  <input type="text" id="bookTitle" name="title" class="form-control" placeholder="책 제목을 입력하세요" required>
                </div>
                <div class="col-md-3">
                  <label for="bookYear" class="form-label">출판 년도</label>
                  <input type="number" id="bookYear" name="year" class="form-control" placeholder="출판 년도" min="1900" max="2100" required>
                </div>
                <div class="col-md-3">
                  <label for="bookCategory" class="form-label">카테고리</label>
                  <input type="text" id="bookCategory" name="category" class="form-control" placeholder="카테고리" required>
                </div>
                <div class="col-md-3">
                  <label for="bookPrice" class="form-label">가격</label>
                  <input type="number" id="bookPrice" name="price" class="form-control" placeholder="가격" min="0" required>
                </div>
                <div class="col-md-6">
                  <label for="authorId" class="form-label">작가 ID</label>
                  <input type="text" id="authorIds" name="authorIds" class="form-control" placeholder="작가 ID를 입력하세요" required>
                </div>
              </div>

              <div class="d-flex justify-content-end mt-3">
                <button type="submit" class="btn btn-primary submit-btn">저장</button>
                <button type="button" class="btn btn-secondary ms-2 reset-btn">초기화</button>
              </div>
            </form>
          </div>

          <div class="alert alert-info mt-3">
            책 데이터는 관계 데이터가 많기 때문에, 연관된 모든 데이터가 동시에 삭제됩니다.(수상기록, 창고, 카테고리 수량, 재고, 예약정보 등)<br> 삭제를 진행하기 전, 주의하시기 바랍니다.
          </div>

          <div class="table-responsive">
            <table class="table table-hover table-bordered">
              <thead class="table-dark">
                <tr>
                  <th scope="col">ISBN</th>
                  <th scope="col">제목</th>
                  <th scope="col">작가</th>
                  <th scope="col">출판 년도</th>
                  <th scope="col">카테고리</th>
                  <th scope="col">가격</th>
                  <th scope="col">액션</th>
                </tr>
              </thead>
              <tbody>
                {{#each books}}
                <tr>
                  <td>{{this.ISBN}}</td>
                  <td>{{this.Title}}</td>
                  <td>{{this.AuthorName}}</td>
                  <td>{{this.Year}}</td>
                  <td>{{this.Category}}</td>
                  <td>{{this.Price}}원</td>
                  <td>
                    <button class="btn btn-warning btn-sm edit-btn" data-id="{{this.ISBN}}" data-title="{{this.Title}}" data-author="{{this.Author}}" data-year="{{this.Year}}" data-category="{{this.Category}}" data-price="{{this.Price}}">
                      수정
                    </button>
                    <form action="/admin/books/delete/{{this.ISBN}}" method="POST" class="d-inline">
                      <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                    </form>
                  </td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        </section>
      {{else if isAuthors}}
        <section id="authors-management">
          <h3>작가 데이터 관리</h3>
          <!-- 알림창 -->
          <div id="formModeIndicator" class="alert alert-primary text-center mb-3">
            현재 모드: 새로운 데이터 추가
          </div>

          <div class="container mt-4">
            <!-- 입력 폼 -->
            <form id="authorForm" action="/admin/authors/add" method="POST" class="mb-5">
              <input type="hidden" id="formMode" value="add">
              <div class="row g-3">
                <div class="col-md-4">
                  <label for="name" class="form-label">작가 이름</label>
                  <input type="text" id="name" name="name" class="form-control" placeholder="작가 이름을 입력하세요" required>
                </div>
                <div class="col-md-4">
                  <label for="address" class="form-label">주소</label>
                  <input type="text" id="address" name="address" class="form-control" placeholder="주소를 입력하세요" required>
                </div>
                <div class="col-md-4">
                  <label for="url" class="form-label">URL</label>
                  <input type="text" id="url" name="url" class="form-control" placeholder="작가 웹사이트 URL" required>
                </div>
              </div>
              <div class="d-flex justify-content-end mt-3">
                <button type="submit" class="btn btn-primary">저장</button>
                <button type="button" class="btn btn-secondary ms-2 reset-btn">초기화</button>
              </div>
            </form>
            <div class="alert alert-info mt-3">
              작가 데이터가 삭제되면, 해당 작가가 집필한 책의 데이터도 함께 삭제됩니다. 삭제시 유의하시기 바랍니다.<br> 공동 집필 책의 경우, 모든 작가가 삭제되어야 삭제됩니다.
            </div>
            <!-- 조회 테이블 -->
            <div class="table-responsive">
              <table class="table table-hover table-bordered">
                <thead class="table-dark">
                  <tr>
                    <th scope="col">ID</th>
                    <th scope="col">이름</th>
                    <th scope="col">주소</th>
                    <th scope="col">URL</th>
                    <th scope="col">액션</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each authors}}
                  <tr>
                    <td>{{this.AuthorID}}</td>
                    <td>{{this.Name}}</td>
                    <td>{{this.Address}}</td>
                    <td>{{this.URL}}</td>
                    <td>
                      <button 
                        class="btn btn-warning btn-sm edit-btn" 
                        data-id="{{this.AuthorID}}" 
                        data-name="{{this.Name}}" 
                        data-address="{{this.Address}}" 
                        data-url="{{this.URL}}">
                        수정
                      </button>
                      <form action="/admin/authors/delete/{{this.AuthorID}}" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                      </form>
                    </td>
                  </tr>
                  {{/each}}
                </tbody>
              </table>
            </div>
          </div>
        </section>
      {{else if isAwards}}
        <section id="awards-management">
          <h3>상 데이터 관리</h3>
          <!-- 현재 모드 표시 -->
          <div id="formModeIndicator" class="alert alert-primary text-center mb-3">
            현재 모드: <strong>새로운 데이터 추가</strong>
          </div>
          <form id="awardForm" action="/admin/awards/add" method="POST" class="mb-5">
            <input type="hidden" id="formMode" name="formMode" value="add">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="awardName" class="form-label">상 이름</label>
                <input type="text" id="awardName" name="name" class="form-control" placeholder="상 이름 입력" required>
              </div>
              <div class="col-md-3">
                <label for="awardYear" class="form-label">년도</label>
                <input type="number" id="awardYear" name="year" class="form-control" placeholder="년도 입력" min="1900" max="2100" required>
              </div>
              <div class="col-md-6">
                <label for="awardISBN" class="form-label">책 ISBN</label>
                <div class="d-flex align-items-center">
                  <input type="text" id="awardISBN" name="isbn" class="form-control" placeholder="책 ISBN 입력" required>
                  <a href="/admin?type=books" target="_blank" class="ms-2 text-muted">책 목록 확인</a>
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-end mt-3">
              <button type="submit" class="btn btn-primary">저장</button>
              <button type="button" class="btn btn-secondary ms-2 reset-btn">초기화</button>
            </div>
          </form>

          <!-- 조회 테이블 -->
          <div class="table-responsive">
            <table class="table table-hover table-bordered">
              <thead class="table-dark">
                <tr>
                  <th scope="col">상 이름</th>
                  <th scope="col">년도</th>
                  <th scope="col">책 ISBN</th>
                  <th scope="col">액션</th>
                </tr>
              </thead>
              <tbody>
                {{#each awards}}
                <tr>
                  <td>{{this.Name}}</td>
                  <td>{{this.Year}}</td>
                  <td>{{this.ISBN}}</td>
                  <td>
                    <button class="btn btn-warning btn-sm edit-btn" 
                            data-name="{{this.Name}}" 
                            data-year="{{this.Year}}" 
                            data-isbn="{{this.ISBN}}">
                      수정
                    </button>
                    <form action="/admin/awards/delete" method="POST" class="d-inline">
                      <input type="hidden" name="name" value="{{this.Name}}">
                      <input type="hidden" name="year" value="{{this.Year}}">
                      <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                    </form>
                  </td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        </section>
      {{else if isWarehouses}}
        <section id="warehouse-management">
          <h3>창고 데이터 관리</h3>
          <!-- 현재 모드 표시 -->
          <div id="formModeIndicator" class="alert alert-primary text-center mb-3">
            현재 모드: 새로운 데이터 추가
          </div>

          <div class="container mt-4">
            <!-- 입력 폼 -->
            <form id="warehouseForm" action="/admin/warehouses/add" method="POST" class="mb-5">
              <input type="hidden" id="formMode" value="add">
              <div class="row g-3">
                <div class="col-md-4">
                  <label for="code" class="form-label">창고 코드</label>
                  <input type="text" id="code" name="code" class="form-control" placeholder="창고 코드를 입력하세요" required>
                </div>
                <div class="col-md-4">
                  <label for="address" class="form-label">주소</label>
                  <input type="text" id="address" name="address" class="form-control" placeholder="주소를 입력하세요" required>
                </div>
                <div class="col-md-4">
                  <label for="phone" class="form-label">전화 번호</label>
                  <input type="text" id="phone" name="phone" class="form-control" placeholder="전화 번호를 입력하세요" required>
                </div>
              </div>
              <div class="d-flex justify-content-end mt-3">
                <button type="submit" class="btn btn-primary">추가</button>
                <button type="button" class="btn btn-secondary ms-2 reset-btn">초기화</button>
              </div>
            </form>
            <div class="alert alert-info mt-3">
              창고 데이터를 삭제하면 재고 정보가 함께 삭제됩니다. 주의하시기 바랍니다.
            </div>
            <!-- 조회 테이블 -->
            <div class="table-responsive">
              <table class="table table-hover table-bordered">
                <thead class="table-dark">
                  <tr>
                    <th scope="col">창고 코드</th>
                    <th scope="col">주소</th>
                    <th scope="col">전화 번호</th>
                    <th scope="col">액션</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each warehouses}}
                  <tr>
                    <td>{{this.Code}}</td>
                    <td>{{this.Address}}</td>
                    <td>{{this.Phone}}</td>
                    <td>
                      <button 
                        class="btn btn-warning btn-sm edit-btn" 
                        data-code="{{this.Code}}" 
                        data-address="{{this.Address}}" 
                        data-phone="{{this.Phone}}">
                        수정
                      </button>
                      <form action="/admin/warehouses/delete/{{this.Code}}" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                      </form>
                    </td>
                  </tr>
                  {{/each}}
                </tbody>
              </table>
            </div>
          </div>
        </section>

      {{else if isInventory}}
        <section id="inventory-management">
          <h3>Inventory 관리</h3>
          <!-- 현재 모드 표시 -->
          <div id="formModeIndicator" class="alert alert-primary text-center mb-3">
            현재 모드: <strong>새로운 데이터 추가</strong>
          </div>
          <form id="inventoryForm" action="/admin/inventory/add" method="POST" class="mb-5">
            <input type="hidden" id="formMode" name="formMode" value="add">
            <div class="row g-3">
              <div class="col-md-4">
                <label for="warehouseCode" class="form-label">창고 코드</label>
                <input type="text" id="warehouseCode" name="code" class="form-control" placeholder="창고 코드를 입력하세요" required>
              </div>
              <div class="col-md-4">
                <label for="bookISBN" class="form-label">책 ISBN</label>
                <input type="text" id="bookISBN" name="isbn" class="form-control" placeholder="책 ISBN을 입력하세요" required>
              </div>
              <div class="col-md-4">
                <label for="inventoryNumber" class="form-label">재고</label>
                <input type="number" id="inventoryNumber" name="number" class="form-control" placeholder="재고 수량을 입력하세요" required>
              </div>
            </div>
            <div class="d-flex justify-content-end mt-3">
              <button type="submit" class="btn btn-primary">저장</button>
              <button type="button" class="btn btn-secondary ms-2 reset-btn">초기화</button>
            </div>
          </form>

          <!-- 조회 테이블 -->
          <div class="table-responsive">
            <table class="table table-hover table-bordered">
              <thead class="table-dark">
                <tr>
                  <th scope="col">창고 코드</th>
                  <th scope="col">책 ISBN</th>
                  <th scope="col">재고</th>
                  <th scope="col">액션</th>
                </tr>
              </thead>
              <tbody>
                {{#each inventory}}
                <tr>
                  <td>{{this.Code}}</td>
                  <td>{{this.ISBN}}</td>
                  <td>{{this.Number}}</td>
                  <td>
                    <button class="btn btn-warning btn-sm edit-btn" 
                            data-code="{{this.Code}}" 
                            data-isbn="{{this.ISBN}}" 
                            data-number="{{this.Number}}">
                      수정
                    </button>
                    <form action="/admin/inventory/delete" method="POST" class="d-inline">
                      <input type="hidden" name="code" value="{{this.Code}}">
                      <input type="hidden" name="isbn" value="{{this.ISBN}}">
                      <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                    </form>
                  </td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        </section>
      {{else if isContains}}
        <section id="contains-management">
          <h3>Contains 데이터 관리</h3>
          <!-- 현재 모드 표시 -->
          <div id="formModeIndicator" class="alert alert-primary text-center mb-3">
            현재 모드: <strong>새로운 데이터 추가</strong>
          </div>
          <form id="containsForm" action="/admin/contains/add" method="POST" class="mb-5">
            <input type="hidden" id="formMode" name="formMode" value="add">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="basketId" class="form-label">장바구니 ID</label>
                <input type="number" id="basketId" name="basketId" class="form-control" placeholder="장바구니 ID 입력" required>
              </div>
              <div class="col-md-6">
                <label for="containsISBN" class="form-label">책 ISBN</label>
                <input type="text" id="containsISBN" name="isbn" class="form-control" placeholder="책 ISBN 입력" required>
              </div>
              <div class="col-md-6">
                <label for="containsNumber" class="form-label">수량</label>
                <input type="number" id="containsNumber" name="number" class="form-control" placeholder="수량 입력" min="1" required>
              </div>
            </div>
            <div class="d-flex justify-content-end mt-3">
              <button type="submit" class="btn btn-primary">저장</button>
              <button type="button" class="btn btn-secondary ms-2 reset-btn">초기화</button>
            </div>
          </form>

          <div class="alert alert-info mt-3">
            Contains 데이터는 기본적으로 고객이 장바구니에 담을 때 자동 생성되도록 설계되어 있습니다.<br> 관리자 권한으로 추가 생성이 가능하지만, 의도된 설계는 <strong>자동 생성된 데이터에 수정, 삭제만 진행</strong>하는 것입니다.
          </div>

          <!-- 조회 테이블 -->
          <div class="table-responsive">
            <table class="table table-hover table-bordered">
              <thead class="table-dark">
                <tr>
                  <th scope="col">장바구니 ID</th>
                  <th scope="col">책 ISBN</th>
                  <th scope="col">수량</th>
                  <th scope="col">액션</th>
                </tr>
              </thead>
              <tbody>
                {{#each contains}}
                <tr>
                  <td>{{this.BasketID}}</td>
                  <td>{{this.ISBN}}</td>
                  <td>{{this.Number}}</td>
                  <td>
                    <button class="btn btn-warning btn-sm edit-btn" 
                            data-basketid="{{this.BasketID}}" 
                            data-isbn="{{this.ISBN}}" 
                            data-number="{{this.Number}}">
                      수정
                    </button>
                    <form action="/admin/contains/delete" method="POST" class="d-inline">
                      <input type="hidden" name="basketId" value="{{this.BasketID}}">
                      <input type="hidden" name="isbn" value="{{this.ISBN}}">
                      <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                    </form>
                  </td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        </section>
      {{else}}
        <p>좌측의 패널에서 원하는 메뉴를 고르세요.</p>
      {{/if}}
    </main>
  </div>
</div>

<style>
  body {
    font-family: 'Arial', sans-serif;
    background-color: #f8f9fa;
  }

  .sidebar {
    height: 100vh;
    padding-top: 20px;
    background-color: #343a40;
    border-radius: 10px;
  }

  .sidebar h4 {
    font-weight: bold;
    font-size: 1.2rem;
    color: white;
  }

  .nav-link {
    font-size: 1rem;
    padding: 0.75rem 1.25rem;
    color: #adb5bd;
    border-radius: 0.3rem;
    transition: background-color 0.2s, color 0.2s;
  }

  .nav-link:hover {
    background-color: #495057;
    color: white;
  }

  .nav-link.active {
    background-color: #007bff;
    color: white !important;
  }

  .content-area {
    background-color: #ffffff;
    padding: 20px;
    border-radius: 8px;
  }

  main h2 {
    color: #495057;
  }
  section#books-management {
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 8px;
  }

  .table-responsive {
    margin-top: 20px;
  }

  .form-label {
    font-weight: bold;
  }

  /* 버튼 스타일 */
  .submit-btn {
    width: 25%;
  }
  /* 작가 목록 확인하기 링크 위치 스타일 */
  .form-label + .d-flex a {
    font-size: 0.875rem;
    white-space: nowrap; /* 줄바꿈 방지 */
  }

  .form-label + .d-flex a:hover {
    text-decoration: underline;
    color: #007bff;
  }
</style>
